% Universal LaTeX headers for e-book publications
\documentclass[oneside,10pt]{book}
%% mobile phone optimized
%%% honor 3C 108 mm x 62 mm scaled 1.1 = 118.8 x 68.2
\usepackage[paperwidth=118.8mm,paperheight=68.2mm,margin=2mm]{geometry}
%% font setup for screen reading
\renewcommand{\familydefault}{\sfdefault}\normalfont
%% hyperlinks pdf style
\usepackage[unicode,colorlinks=true,linkcolor=blue,urlcolor=blue]{hyperref}

% if you use colorlinks=true you can set (defaults in []):
% linkcolor [red]
% anchorcolor [black]
% citecolor [green]
% filecolor [cyan]
% menucolor [red]
% runcolor [cyan - same as file color]
% urlcolor [magenta]
% allcolors -- use this if you want to set all links to the same color

%% fix heading styles for tiny paper
% http://tug.ctan.org/tex-archive/macros/latex/contrib/titlesec/titlesec.pdf
\usepackage[compact]{titlesec}
% \titleformat{\chapter}{\Large\bfseries}{\thechapter.}{1em}{}
% \titlespacing{\chapter}{0pc}{1.5ex plus .1ex minus .2ex}{1pc}
% \titleformat{\section}{\large\bfseries}{\thesection.}{1em}{}
% \titlespacing{\chapter}{0pc}{1.5ex plus .1ex minus .2ex}{1pc}
%% toc styling
\usepackage{tocloft}
\renewcommand{\cftbeforetoctitleskip}{0pt}
\renewcommand{\cftaftertoctitleskip}{0pt}


% Cyrillization
\usepackage[T1,T2A]{fontenc}
\usepackage[utf8]{inputenc}
%% \usepackage[cp1251]{inputenc}
% \usepackage[english,russian]{babel}
\usepackage[english]{babel}
% \usepackage{indentfirst}

% title page
\usepackage{titling}
\usepackage{multirow}

% graphics
\usepackage[pdftex]{graphicx}
\usepackage{float}
\usepackage{wrapfig}
\newcommand{\fig}[2]{\noindent\includegraphics[#2]{#1}}
\newcommand{\bibfig}[1]{\noindent\includegraphics[height=.72\textheight]{doc/bib/#1}}

% extended tables
\usepackage{tabularx}

% xcolor fixes
\usepackage{xcolor}
\definecolor{red}{rgb}{0.7,0,0}		% R
\definecolor{green}{rgb}{0,0.3,0}	% G
\definecolor{blue}{rgb}{0,0,0.7}	% B
\definecolor{cyan}{rgb}{0,0.6,0.6}	% cyan
\definecolor{magenta}{rgb}{0.7,0,0.7}	% magenta
\definecolor{lstcolor}{rgb}{0.8,0.9,0.9} % listings

% relative sectioning
\usepackage{ifthen}
\newcounter{secdepth}\setcounter{secdepth}{0}
\newcommand{\secup}{\addtocounter{secdepth}{1}}
\newcommand{\secdown}{\addtocounter{secdepth}{-1}}
\newcommand{\secrel}[1]{
\ifthenelse{\equal{\value{secdepth}}{0}}{\part{#1}}{}
\ifthenelse{\equal{\value{secdepth}}{-1}}{\chapter{#1}}{}
\ifthenelse{\equal{\value{secdepth}}{-2}}{\section{#1}}{}
\ifthenelse{\equal{\value{secdepth}}{-3}}{\subsection{#1}}{}
\ifthenelse{\equal{\value{secdepth}}{-4}}{\subsubsection{#1}}{}
}
\newcommand{\secly}[1]{
\section*{#1}
\addcontentsline{toc}{section}{#1}
}
\newcommand{\subsecly}[1]{
\subsection*{#1}
\addcontentsline{toc}{subsection}{#1}
}

% computer-related markup: manuals, listings, CS

%% listings
\usepackage{verbatim}
% % \usepackage{courier}
\usepackage[cachedir=tmp,newfloat]{minted}
% \usemintedstyle{VS}
\usemintedstyle{xcode}
% \renewcommand{\listingscaption}{\#}
\usepackage{caption}
\setlength\abovecaptionskip{+.3\baselineskip}
\setlength\belowcaptionskip{-1.5\baselineskip}
% https://stackoverflow.com/a/30486385/2134384
% https://ru.overleaf.com/learn/latex/Code_Highlighting_with_minted
% https://texdoc.org/serve/minted.pdf/0
% http://aakinshin.blogspot.com/2014/01/latex-minted.html
\setminted{
    linenos=true,
    % bgcolor=lstcolor
    frame=lines,
    fontsize=\normalsize,
    % basicstyle=\scriptsize\ttfamily
    % caption=\#
}
% \renewcommand{\listoflistingscaption}{listings \& files}
% % \renewcommand{\cftbeforelistoflistingstitleskip}{0pt}
% \usepackage{float}
\newcommand{\lstx}[4]{
    \noindent
    % \begin{minipage}{\linewidth}
    % \begin{listing}[!h]
        % \begin{minipage}{\linewidth}
            \captionof{listing}{#3}
            % \caption{#3}
            \inputminted[#4]{#2}{#1}
        % \end{minipage}
    % \end{listing}
    % \end{minipage}
}
\newcommand{\lst}[3]{\lstx{#1}{#2}{#3}{}}

%% OSes
\newcommand{\win}{\texttt{Windows}}
\newcommand{\lin}{\texttt{Linux}}

%% languages
\newcommand{\mel}{\texttt{metaL}}
\newcommand{\py}{\texttt{Python}}
\newcommand{\lisp}{\texttt{Lisp}}

%% programs
\newcommand{\gh}{GitHub}


% misc
\newcommand{\email}[1]{$<$\href{mailto:#1}{#1}$>$}
\newcommand{\note}[1]{\footnote{\,#1}}
\newcommand{\term}[1]{\textcolor{green}{#1}}
\newcommand{\file}[1]{\texttt{#1}}
\newcommand{\class}[1]{\textbf{#1}}
\newcommand{\var}[1]{\textbf{#1}}
\newcommand{\fn}[1]{\textbf{#1}}
\newcommand{\prog}[1]{\textbf{#1}}
\newcommand{\lib}[1]{\textbf{#1}}

\newcommand{\cm}[1]{\textbf{Cortex-M#1}}
